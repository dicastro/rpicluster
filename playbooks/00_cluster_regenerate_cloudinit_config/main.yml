---
- hosts: rpicluster
  gather_facts: false

  vars:
    ssh_key: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      30633862323635386231383835366138363361383665616262316539626238383031313665393933
      6633336133636632346232366663626439316630333139650a623733616434303461326163356263
      64316163326364383631623230633232303163643466323465343165343462373564653138373364
      3030323037383636660a353830643931396332653637656432626365633266356535306233653031
      37646563626362626538313338663538373532623834303264643932666166373264386561633734
      63363830393562323162666638343034626131323466346634343539356463343464373232343764
      62336138613935613437376266616537393631616266363131396537323833323961373539633234
      33353035633833656463346166656537303534343765303036393961373037636561363638613639
      31646237623733353436313839623030363538653535616631303036333865663430623535366137
      36363966343036643430643461363665626235613537646161626264316564353661336462313434
      63336538656539656639633330653934363166643063396231343265623961313937656133623031
      62643431323464666531643363623866633066303231363437393439373863303266643134633538
      36366564666539613231633139313134666161353532653061353837663065323230623861383238
      61666233386665626136376531386365616331336265393536613634303730306264643165346638
      32633732653434306361313662653862656561386433393033346439363033393634376664646264
      65363239316634653062643139343435386463376133336633353633333732663135333464366338
      65636137643433363766343738376135616230363366633464613161613537323839636662336133
      31383938326139386135613930643765373233333462353832346136306431333065613061383762
      37366363353036613632363763373930333462626435626639396132623831393463373536353431
      35613133303132363666336539303131666163326266626262616136343163646561343565313731
      64366431353662376335366264626262393563613637653863383931623232303139616530373138
      36373538383931373533363332613935613966386438653138386635653864323534323832366661
      62393233306136396639313965353839363864326130383035313732393365663837353139303639
      34656539343634636130323866643036343064623663613965366633633731316238646237643338
      33386564643165306266346434306137356238326265323334616437623962303033636538313362
      65363262303732373831636531373666666261303939363835333238666461623064383534663861
      33356336616135373230303161633764386162376131636263363361363064303734656562323762
      38393734613064346661656334626666346333653139353030653161373636343161666463393164
      39353134346632343165336466333363346464366532376665303466303338366561313433373230
      34396465353536373733633531386334336132303138303934353434623231396661643030383163
      37353365393039613036663237643136336639366135386635653134313539393732366638623365
      62383136646332663037613137373466666362336130396465663434353831323562373862613032
      62623665386236303630313832306233363735336531386532613162636231393063373166396538
      63363239616133356135393166336462333436666266376364323865653764663038613762353662
      34393865623335333834366134386439376462313638326366363135613034663634666666356533
      61643762313663656536393563643663323930393733316436636536323261363261653832383461
      37623063353365343738313162623930313837323866616566316363333933663534393634393863
      36616361363361363764646663636533383438333165623530373232353462633130333638376364
      37643765653936333731623935363034313030663861643464613734643564616538346434303463
      62656234633663616564663763353063616665333238623063636639336361383331333036653039
      31643132623938623034373566336435656264363933623062623534333535653232316237363266
      3635363964393562333665366433346335636630323135333461

  tasks:
    - name: create directories
      file:
        path: "../../cloud-init/{{ hostvars[inventory_hostname]['custom_hostname'] }}"
        state: directory
      delegate_to: localhost

    - name: generate user-data config file from template
      template:
        src: template_userdata.j2
        dest: "../../cloud-init/{{ hostvars[inventory_hostname]['custom_hostname'] }}/user-data"
      delegate_to: localhost

    - name: generate network-config file from template
      template:
        src: template_networkconfig.j2
        dest: "../../cloud-init/{{ hostvars[inventory_hostname]['custom_hostname'] }}/network-config"
      delegate_to: localhost

    - name: generate cmdline.txt file from template
      template:
        src: template_cmdline.txt.j2
        dest: "../../cloud-init/{{ hostvars[inventory_hostname]['custom_hostname'] }}/cmdline.txt"
      delegate_to: localhost
